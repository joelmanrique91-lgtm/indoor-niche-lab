{% extends 'base.html' %}
{% block content %}
<h1>{{ stage.name }}</h1>
{% if stage.id == 13 %}
<img class="stage-banner" src="/static/img/generated/stage_detail-01-proceso-real-de-hidrataci-n-y-pasteurizaci-n-del-sustrato-lg.webp" alt="Proceso real de hidratación y pasteurización del sustrato" loading="lazy">
{% elif stage.id == 14 %}
<img class="stage-banner" src="/static/img/generated/stage_detail-02-incubaci-n-del-cultivo-en-ambiente-controlado-lg.webp" alt="Incubación del cultivo en ambiente controlado" loading="lazy">
{% else %}
<img class="stage-banner" src="/static/img/generated/stage_detail-03-incubaci-n-del-cultivo-en-ambiente-controlado-lg.webp" alt="Etapa del cultivo de hongos en condiciones reales" loading="lazy">
{% endif %}
<p><a href="/stages">← Volver a etapas</a></p>

{% for step in steps %}
<article class="card stage-step-card">
  <img
    class="stage-step-image"
    src="{{ [
      '/static/img/generated/stage_detail-04-materiales-costo-estimado-usd-lg.webp',
      '/static/img/generated/stage_detail-05-miniatura-del-proceso-step-title-lg.webp',
      '/static/img/generated/stage_detail-06-miniatura-del-proceso-step-title-lg.webp',
      '/static/img/generated/stage_detail-07-materiales-costo-estimado-usd-lg.webp'
    ][loop.index0 % 4] }}"
    alt="Miniatura del proceso: {{ step.title }}"
    loading="lazy"
  >
  <h2>{{ loop.index }}. {{ step.title }}</h2>
  <p style="white-space: pre-line;">{{ step.content }}</p>
  <p><strong>Materiales:</strong></p>
  <ul>
    {% for tool in step.tools_json %}
    <li>{{ tool }}</li>
    {% endfor %}
  </ul>
  <p><strong>Costo estimado:</strong> USD {{ '%.2f'|format(step.estimated_cost_usd or 0) }}</p>
</article>
{% else %}
<p>Esta etapa todavía no tiene pasos cargados.</p>
{% endfor %}
{% endblock %}
