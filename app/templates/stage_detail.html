{% extends 'base.html' %}
{% block content %}
<h1>{{ stage.name }}</h1>
{% if stage.id == 13 %}
<img class="stage-banner" src="https://images.unsplash.com/photo-1621911762451-4f812f0f4a95?auto=format&fit=crop&w=1500&q=70" alt="Proceso real de hidratación y pasteurización del sustrato" loading="lazy">
{% elif stage.id == 14 %}
<img class="stage-banner" src="https://images.unsplash.com/photo-1611255279432-22f2a9fb2608?auto=format&fit=crop&w=1500&q=70" alt="Incubación del cultivo en ambiente controlado" loading="lazy">
{% else %}
<img class="stage-banner" src="https://images.unsplash.com/photo-1457530378978-8bac673b8062?auto=format&fit=crop&w=1500&q=70" alt="Etapa del cultivo de hongos en condiciones reales" loading="lazy">
{% endif %}
<p><a href="/stages">← Volver a etapas</a></p>

{% for step in steps %}
<article class="card stage-step-card">
  <img
    class="stage-step-image"
    src="{{ [
      'https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?auto=format&fit=crop&w=420&q=70',
      'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&w=420&q=70',
      'https://images.unsplash.com/photo-1603048719539-9ecb5e3cdd1e?auto=format&fit=crop&w=420&q=70',
      'https://images.unsplash.com/photo-1471194402529-8e0f5a675de6?auto=format&fit=crop&w=420&q=70'
    ][loop.index0 % 4] }}"
    alt="Miniatura del proceso: {{ step.title }}"
    loading="lazy"
  >
  <h2>{{ loop.index }}. {{ step.title }}</h2>
  <p style="white-space: pre-line;">{{ step.content }}</p>
  <p><strong>Materiales:</strong></p>
  <ul>
    {% for tool in step.tools_json %}
    <li>{{ tool }}</li>
    {% endfor %}
  </ul>
  <p><strong>Costo estimado:</strong> USD {{ '%.2f'|format(step.estimated_cost_usd or 0) }}</p>
</article>
{% else %}
<p>Esta etapa todavía no tiene pasos cargados.</p>
{% endfor %}
{% endblock %}
