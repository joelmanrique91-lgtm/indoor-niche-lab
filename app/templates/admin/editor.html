{% extends 'base.html' %}
{% block content %}
<h1>Editor simple</h1>
<p class="notice">"Guardar etapa" crea o actualiza título, descripción de orden e imágenes de etapa. "Agregar paso" suma un paso nuevo a la etapa elegida con materiales, costo e imagen.</p>

<section class="card">
  <h2>Crear o editar etapa</h2>
  <form method="post" action="/admin/editor/stage" class="stack" data-validate-form>
    <label for="stage_id">ID (opcional para editar)</label>
    <input id="stage_id" type="number" name="stage_id" placeholder="ID (opcional para editar)" />
    <label for="stage_name">Nombre de etapa</label>
    <input id="stage_name" type="text" name="name" placeholder="Nombre de etapa" required />
    <label for="stage_order">Orden</label>
    <input id="stage_order" type="number" name="order_index" placeholder="Orden" required />
    <label for="stage_image_card_1">Imagen tarjeta 1 (path en /static, opcional)</label>
    <input id="stage_image_card_1" type="text" name="image_card_1" placeholder="section-images/stages/stage.card.1.v1.svg" />
    <label for="stage_image_card_2">Imagen tarjeta 2 (path en /static, opcional)</label>
    <input id="stage_image_card_2" type="text" name="image_card_2" placeholder="section-images/stages/stage.card.2.v1.svg" />
    <label for="stage_image_hero">Imagen hero (path en /static, opcional)</label>
    <input id="stage_image_hero" type="text" name="image_hero" placeholder="section-images/stages/stage.hero.v1.svg" />
    <p class="form-error" data-form-error aria-live="polite"></p>
    <button class="btn" type="submit">Guardar etapa</button>
  </form>
</section>

<section class="card">
  <h2>Agregar paso</h2>
  <form method="post" action="/admin/editor/step" class="stack" data-validate-form enctype="multipart/form-data">
    <label for="step_stage">Etapa</label>
    <select id="step_stage" name="stage_id" required>
      <option value="">Elegí etapa</option>
      {% for stage in stages %}
      <option value="{{ stage.id }}">{{ stage.order_index }}. {{ stage.name }}</option>
      {% endfor %}
    </select>
    <label for="step_title">Nombre del paso</label>
    <input id="step_title" type="text" name="title" placeholder="Título del paso" required />
    <label for="step_content">Objetivo</label>
    <textarea id="step_content" name="content" placeholder="Contenido del paso" required></textarea>
    <label for="step_tools">Materiales separados por coma</label>
    <input id="step_tools" type="text" name="tools_csv" placeholder="Materiales separados por coma" />
    <label for="step_cost">Costo estimado USD</label>
    <input id="step_cost" type="number" step="0.01" min="0" name="estimated_cost_usd" placeholder="Costo estimado USD" />
    <label for="step_image">Imagen del paso (path en /static, opcional)</label>
    <input id="step_image" type="text" name="image" placeholder="img/generated/stages/step-ejemplo/md.jpg" />
    <label for="step_image_file">Subir imagen del paso (jpg, png, webp)</label>
    <input id="step_image_file" type="file" name="image_file" accept=".jpg,.jpeg,.png,.webp" />
    <p class="form-error" data-form-error aria-live="polite"></p>
    <button class="btn" type="submit">Agregar paso</button>
  </form>
</section>

{% if selected_stage %}
<section>
  <h2>Pasos de: {{ selected_stage.name }}</h2>
  {% for step in steps %}
    <article class="card"><h3>{{ step.title }}</h3><p>{{ step.content }}</p></article>
  {% else %}
    <p>No hay pasos cargados para esta etapa.</p>
  {% endfor %}
</section>
{% endif %}
{% endblock %}
