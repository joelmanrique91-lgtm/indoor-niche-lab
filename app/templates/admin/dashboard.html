{% extends 'base.html' %}
{% block content %}
<h1>Admin</h1>
{% if message %}<p class="notice">{{ message }}</p>{% endif %}

<section class="card">
  <h2>Orden recomendado</h2>
  <ol>
    <li>Inicializar DB</li>
    <li>Cargar demo</li>
    <li>Revisar Etapas y Kits</li>
    <li>(Opcional) Generar con IA</li>
  </ol>
</section>

<section class="grid">
  <article class="card">
    <h3>Inicializar DB</h3>
    <p>Crea/rehace la base local para empezar de cero. Usar solo si no hay datos o se quiere reset.</p>
    <p><strong>Cuándo usarlo:</strong> antes de una demo nueva o si la DB quedó inconsistente.</p>
    <form method="post" action="/admin/init-db" class="async-action-form" data-no-redirect="true">
      <button class="btn icon-btn" type="submit">
        <img src="/static/assets/icons/database.svg" alt="" width="20" height="20" />
        <span>Inicializar DB</span>
      </button>
      <span class="action-status" aria-live="polite"></span>
    </form>
  </article>

  <article class="card">
    <h3>Cargar demo</h3>
    <p>Carga datos de ejemplo (etapas, pasos, kits) con imágenes placeholder para ver la web completa.</p>
    <p><strong>Cuándo usarlo:</strong> luego de inicializar DB para tener contenido visible de inmediato.</p>
    <form method="post" action="/admin/seed-demo" class="async-action-form" data-no-redirect="true">
      <button class="btn icon-btn" type="submit">
        <img src="/static/assets/icons/upload.svg" alt="" width="20" height="20" />
        <span>Cargar demo</span>
      </button>
      <span class="action-status" aria-live="polite"></span>
    </form>
  </article>
</section>

<section class="card">
  <h2>Generar con IA (por etapa)</h2>
  <p>Genera imágenes/contenido para la etapa seleccionada. Requiere OPENAI_API_KEY. Si no hay key, se mantiene modo demo con placeholders.</p>
  <div class="grid admin-stage-grid">
  {% for stage in stages %}
    <form method="post" action="/admin/generate/{{ stage.id }}" class="card stage-generate-card async-action-form" data-no-redirect="true">
      <img class="stage-thumb" src="{{ stage_illustration(stage.name) }}" alt="Ilustración de la etapa {{ stage.name }}" width="48" height="48" />
      <div>
        <p><strong>{{ stage.order_index }}. {{ stage.name }}</strong></p>
        <button class="btn btn-secondary icon-btn" type="submit">
          <img src="/static/assets/icons/ai.svg" alt="" width="20" height="20" />
          <span>Generar con IA</span>
        </button>
        <span class="action-status" aria-live="polite"></span>
      </div>
    </form>
  {% else %}
    <p>No hay etapas para generar.</p>
  {% endfor %}
  </div>
</section>

<section class="card">
  <h2>Editor manual</h2>
  <p>Editar etapas y pasos manualmente (nombres, checklist, materiales, costos, imágenes).</p>
  <a href="/admin/editor" class="admin-editor-link">
    <img src="/static/assets/icons/edit.svg" alt="" width="20" height="20" />
    <span>Ir al editor de etapas y pasos</span>
  </a>
</section>
{% endblock %}
